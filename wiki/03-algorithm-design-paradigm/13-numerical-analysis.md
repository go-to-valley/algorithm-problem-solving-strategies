# 13. 수치 해석

## 도입

수치 해석(numerical analysis)는 직접 풀기 힘든 수학 문제를 근사적으로 푸는 알고리즘과 이들의 수치적 안정성, 오차의 범위 등을 연구하는 전산한의 한 분야이다. 자세히 다루는 문제는 대회에서 출제되지 않으나 기초적인 몇 가지 알고리즘은 자주 유용하게 쓰인다.

## 이분법

대회에서 가장 유용한 수치 해석 알고리즘은 이분법(bisection method)이다. 이 절에서는 이분법의 이론적인 배경과 구현에 관한 유의사항들을 소개한다.

### 이분법의 정의

이분법은 주어진 범위 `[lo, hi]`내에서 어떤 함수 `f(x)`의 값이 0이 되는 점을 수치적으로 찾아내는 기법이다. 이분법 기법은 먼저 `f(lo) <= 0`이 되는 점 `lo`와 `f(hi) > 0`이 되는 점 `hi`를 찾는다. 연속인 함수에서 중간값 정리에 의해 이 두 점 사이에서 `f(x) = 0`이 되는 지점이 반드시 존재한다. 따라서 두 점의 중간점 `mid`를 검사하여 `f(lo) <= 0` 와 `f(hi) > 0`을 만족하도록 `lo`나 `hi`를 업데이트 시켜주고 다시 이를 재귀적으로 수행하면 된다.

### 절대 오차를 이용한 종료 판정

이분법에서 가장 중요한 부분은 `while`문의 종료 조건이다. 많이 수행하면 오차는 줄겠지만 영원히 수행할 수 없으니 정확도와 수행 속도 사이에서 종료 조건을 잘 선택해야 한다. 일반적으로 대회의 문제가 정답과 특정 값(최대 오차) 이하의 차이가 나는 답들 또한 인정한다고 하면, 종료 조건은 `|lo - hi| <= 최대오차` 로 주면 된다.

### 상대 오차를 이용한 종료 판정

부동 소수점의 한계로 `lo`와 `hi`가 매우 작은 값일 때 둘 사이에 자료형이 표현할 수 있는 값이 하나도 없을 수 있다. 이 때 둘 사이의 차이가 최대 오차보다 크면 반복문이 절대 종료되지 않는 문제가 생긴다.

프로그래밍 대회에서는 이러한 문제로 인해 상대 오차도 허용하고 있다. 예를 들어 최대 오차가 10^(-7)일 때, 반환 값의 오차가 10^(-7)보다 크다 하더라도 정답 A에 대해 `[A * (1 - 10^(-7)),A * (1 + 10^(-7))]`까지의 범위에 포함되는 답을 정답으로 인정하는 것이다.

따라서 근사 값 `(lo + hi) / 2`가 정답으로 인정받기 위해서는 다음 조건이 참이어야 한다.

```java
(1 - 10^(-7)) * hi < (lo + hi)/2 < (1 + 10^(-7)) * lo
```

단 이 조건은 `lo` , `hi` 가 모두 양수라 가정할 때이다. 만약 음수가 낀다면 더욱 복잡해져서 실제 프로그래밍 대회 참가자들은 다른 방법을 쓴다.

### 정해진 횟수만큼 반복하기

단순해 보이지만 가장 유용한 방법은 `while`문을 적당한 `for`문으로 대체해서 반복문이 항상 정해진 횟수만큼 실행되도록 하는 방법이다. 단순하게 100번 반복문을 실행한다고 가정하면, 반환하는 답의 절대 오차는 `|lo - hi|/(2^101)`이 된다. 대략 `|hi - lo|`가 10^20 미만의 수라면 이 오차는 항상 10^(-7)보다 작아 충분히 답을 구할 수 있다.

### 예제: 단변수 다항 방적식의 수치적 해법(문제 ID: ROOTS, 난이도 중)

[링크](https://algospot.com/judge/problem/read/ROOTS)

다항 방정식의 근은 단순하게 극점을 찾고 각 극점들 사이에 이분법을 적용해 구할 수 있다. 왼쪽 오른쪽 양 끝의 극점의 경우는 각 극점보다 크거나 작은 특정 값을 이용해 이분법으로 처리한다.

극점은 미분으로 쉽게 구할 수 있으므로, 실제 알고리즘은 원 다항식을 미분해 근을 다시 찾는 재귀 호출을 반복하여 구현할 수 있다.

### 예제: 전세금 균등상환 (문제 ID: LOAN, 난이도 하)

[링크](https://algospot.com/judge/problem/read/LOAN)

전세금 N원을 연이율 P%로 대출받고, 이것을 M(1≤M≤120)개월 동안 매달 일정액 C원씩 갚는다고 하자.

대출의 잔금은 대출 기간동안 다음과 같이 계산된다.

- 대출의 잔금은 대출 금액 N원에서 시작한다.
- 한 달이 지날 때마다 대출 잔금이 월 이자 P/12 %만큼 불어난다.
- 이자가 추가된 다음 월 상환액 C를 대출 잔금에서 제한다.

이 때 M개월 걸려 모든 대출 금액을 다 갚기 위해서는 한달에 최소 얼마씩 갚아야 할까?

매달 C원씩 상환할 때 M개월 후의 대출 잔액을 `balance(C)` 라고 하면 이 문제는 단순히 `balance(C) = 0`이라는 방정식을 푸는 문제가 된다. 다만 이 함수는 반복문을 이용하는 함수이므로 역함수를 구하기 어렵게 되기에 이분법을 사용해 간단히 풀 수 있다.

## 문제

[승률 올리기 (문제 ID: RATIO, 난이도 하)](https://algospot.com/judge/problem/read/RATIO)

## 삼분 검색

### 조건

삼분 검색(tenary search)를 하기 위해서는 함수에 조건이 필요하다. 먼저 한 개의 지역 극대점이 있어야 한다. 그 다음 지역 극대점을 기준으로 왼쪽은 단조 증가가 아닌 순 증가, 오른쪽은 단조 감소가 아닌 순 감소해야한다. 이 조건을 만족할 경우 해당 함수에서 최대점을 찾는 방법으로 삼분 검색을 사용할 수 있다.(정 반대의 경우에는 최소치를 찾을 수 있다.)

### 삼분 검색

위 조건을 만족하는 함수에서 최대치를 포함하는 구간을 `[lo, hi]`라고 하자. 그러면 이 구간을 삼등분 하는 위치는 각각 `(2*lo + hi) / 3`, `(lo + 2*hi) / 3`이 된다. 각 위치에서 함수 값을 계산 했을 때, 왼쪽 값이 오른쪽 값보다 작다고 가정하면, 왼쪽 좌표를 기준으로 왼쪽 구간은 바로 오른쪽 구간이 순 증가하기 때문에 함수의 구조에 따라 최대치가 있을 수 없다. 따라서 답이 존재할 구간을 오른쪽의 두 구간으로 한정 지을 수 있고 새로 얻은 구간에서 같은 과정을 반복해 최대값을 찾을 수 있다.

### 왜 쓰나?

삼분 검색은 미분 불가능한 함수에도 사용 가능하며, 국소 탐색(local search) 보다 훨씬 빠르게 동작하며, 수렴 판정이 용이하다.

### 예제: 철인 2종 경기

달리기와 자전거로 총 t킬로미터를 달리는 철인 2종 경기를 개최한다. 0번부터 n-1번 까지 모두 n명의 참가자가 등록했고, 각 참가자가 주최측에 뇌물을 건네며 자신이 승리할 수 있도록 달리기와 자전거 경주의 길이를 조정해달라고 요청했다. 이 참가자가 2등과 가장 큰 차이로 우승하려면 달리기 경주의 길이 r과 자전거 경주의 길이 t-r을 어떻게 정해야 할까?

### 수학으로 표현하기

i번째 선수의 달리기 속도가 시속 `run_i` 킬로미터, 자전거 속도가 시속 `cycle_i` 킬로미터라고 할 때 해당 선수의 `time_i(r)`을 다음과 같이 계산할 수 있다.

`time_i(r) = r/run_i + (t-r)/cycle_i`

최대화하고 싶은 값은 n-1번 선수의 기록과 나머지 선수 중 가장 잘 한 선수 기록의 차이이다. 이 때 n-1번 선수의 기록을 `chearter(r)`, 나머지 선수 중 가장 잘 한 선수의 기록을 `others(r)`이라고 표시하면 두 함수를 다음과 같이 정의할 수 있다.

`cheater(r) = time_n-1(r)`

`others(r) = min(time_i(r)), (i = 0...n-2)`

`others(r)`을 그래프로 표현하면 아래에서 볼 때 오목한 함수가 된다. 오목 함수 혹은 볼록 함수는 삼분 검색의 조건을 거의 만족한다. 조건을 만족하지 않는 유일한 부분은 수평선이 존재할 수 있다는 것인데, 이 경우도 최대,최소 점에서만 수평선이 존재할 수 있어 사실상 삼분 검색으로 항상 풀 수 있다.

우리가 구하고자 하는 값은 `others(r) - cheater(r)`의 최대치이고 `chearter(r)`은 r에 대해 선형 함수인데, 선형 함수는 볼록이면서 동시에 오목 함수이기에 `others(r) - cheater(r)`은 결론적으로 오목함수이다. 따라서 결과적으로 삼분 검색을 이용해 원하는 값을 구할 수 있다.

## 문제

[꽃가루 화석 (문제 ID: FOSSIL, 난이도 상)](https://algospot.com/judge/problem/read/FOSSIL)

## 다른 주제들

종종 수치 해석 알고리즘을 유용하게 사용할 수 있다. 대표적인 예가 수치 적분 알고리즘이다. 그 중 간단하고 유용한 방법으로 심슨 방법이 있다. 심슨 방법은 주어진 구간의 함수를 2차 함수로 근사해서 적분하며, 적분하는 함수가 2차 이하의 함수라면 항상 정확한 값을 반환하기 때문에 특히 유용하다.
